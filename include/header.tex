%%% warn about LaTeX 'sins'
\RequirePackage[l2tabu, orthodox]{nag}


%%% KOMA class
\documentclass[
     a4paper
    ,12pt
    ,titlepage=true
    ,fleqn
    ,oneside
    ,english
    ,pagesize
    % ,draft
]{scrbook}


%%% Fonts, encoding
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage[defaultsans,scale=.93]{lato}
\usepackage[scale=.91]{sourcecodepro}
\usepackage[T1]{fontenc}


%%% Math, symbols, units
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xspace}
\usepackage{xfrac}
\usepackage{bm}
\usepackage{dsfont}    % for identity-matrix
\IfFileExists{siunitx.sty}{
    \usepackage{siunitx}
}{
    \message{Warning: siunitx package is missing.}
}

% Bold vectors
\renewcommand{\vec}[1]{\mathbf{#1}}

% This redefines a linebreak '\\' inside the 'align'-environment.
% It adds \notag to all equations except the last (only one label
% for multi-line equations).
\makeatletter
\def\Let@{\def\\{\notag\math@cr}}
\makeatother


%%% Graphics
\usepackage{graphicx}
\usepackage{subfig}
\usepackage[
     font=small
    ,labelfont=bf
]{caption}
\captionsetup*[figure]{name=Fig.}
\graphicspath{{fig/}}


%%% Layout, typesetting, formatting
\usepackage{tabu}
\usepackage{booktabs}
\usepackage{microtype}
\usepackage[iso]{datetime}
\usepackage[automark,headsepline=.6pt,draft=false]{scrlayer-scrpage}


%%% Colors
\usepackage{xcolor}
\definecolor{tblue}{rgb}{0.,0.4,1}
\definecolor{tmagenta}{rgb}{.92,0,0.55}


%%% Hyperref
\usepackage[
     pdfusetitle
    ,colorlinks=true
    ,citecolor=tblue
    ,linkcolor=tblue
    ,urlcolor=tmagenta
    ,pdfborder={0 0 0}
    ,unicode=true
]{hyperref}


%%% Bibliography
\usepackage{csquotes}
\usepackage[
     backend=biber
    ,defernumbers=true
    ,style=numeric-comp
    ,doi=false
    ,url=false
    ,isbn=false
    ,arxiv=abs
    ,firstinits=true
    ,hyperref=true
    ,backref=true
    ,maxnames=8
    ,sorting=none
]{biblatex}

\addbibresource[label=my-publications]{bibliography/my-publications.bib}
\addbibresource[label=all]{bibliography/all.bib}

% do not show month and journal issue:
\AtEveryBibitem{
    \clearfield{month}
    \clearfield{number}
}

% only show starting page 494 of a page range like 494-499.
% also, suppress the 'p. ' prefix
\DeclareFieldFormat{pages}{\mkfirstpage{#1}}

% remove the prefix 'In: '
\renewbibmacro{in:}{}

% regular journal title, bold volume number
\DeclareFieldFormat*{journaltitle}{#1}
\DeclareFieldFormat*{volume}{\mkbibbold{#1}}

% Hyperlink the title to DOI website
\newbibmacro{string+doi}[1]{%
      \iffieldundef{doi}{#1}{\href{http://dx.doi.org/\thefield{doi}}{#1}}}
      \DeclareFieldFormat{title}{\usebibmacro{string+doi}{\mkbibemph{#1}}}
      \DeclareFieldFormat[article]{title}{\usebibmacro{string+doi}{\mkbibquote{#1}}}


%%% Metadata
\AtBeginDocument{
    \title{\thesisTitle}
    \author{\thesisAuthor}
    \date{\thesisDate}
}


%%% Section title
% \usepackage[small,sc]{titlesec}


%%% Chapter pages
\usepackage{xparse}
\usepackage{quotchap}
\NewDocumentEnvironment{tquote}{m}{
    \begin{savequote}[5.5cm]
        \begin{flushleft}
}{
    \end{flushleft}
    \qauthor{--- #1}
\end{savequote}
}
\colorlet{chaptergrey}{gray!50}


%%% Languages
\usepackage[ngerman,main=english]{babel}


%%% References
\usepackage[noabbrev]{cleveref}


%%% Appendix
\usepackage[toc]{appendix}
\Crefname{appendixchapter}{Appendix}{Appendices}
\crefname{appendixchapter}{appendix}{appendices}


%%% Best practices
\ObsoleteCS[unnecessary]{eqref}{\protect\tref\space or \protect\cref}
\ObsoleteEnv[probably not what you wanted]{align*}{align}


%%% Development
\usepackage{todonotes}
\presetkeys{todonotes}{color=red!30,inline,prepend,caption=TODO}{}


%%% LaTeX warnings
% see http://tex.stackexchange.com/q/183149
% and http://tex.stackexchange.com/a/198590
\begingroup\expandafter\expandafter\expandafter\endgroup
\expandafter\ifx\csname pdfsuppresswarningpagegroup\endcsname\relax
\else
    \pdfsuppresswarningpagegroup=1\relax
\fi



\AtEndPreamble{
    \input{include/latex-report/include/commands.tex}
    \input{include/commands.tex}
    \input{include/abbreviations.tex}
}
